<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Ultimate Country Explorer (Wikipedia Edition)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    * {
      box-sizing: border-box;
    }

    :root {
      --bg: radial-gradient(circle at top, #1f2933, #020617);
      --text: #e5e7eb;
      --muted: #6b7280;
      --muted-strong: #9ca3af;
      --card-bg: rgba(15, 23, 42, 0.9);
      --border-color: rgba(148, 163, 184, 0.25);
      --pill-bg: rgba(31, 41, 55, 0.9);
      --pill-border: rgba(148, 163, 184, 0.5);
      --input-bg: rgba(15, 23, 42, 0.9);
      --shadow-heavy: 0 18px 50px rgba(0, 0, 0, 0.7);
      --shadow-card: 0 16px 40px rgba(0, 0, 0, 0.6);
      --divider: rgba(148, 163, 184, 0.5);
      --badge-blue-bg: rgba(37, 99, 235, 0.15);
      --badge-blue-border: rgba(59, 130, 246, 0.5);
      --badge-blue-text: #bfdbfe;
      --status-ok: #bbf7d0;
      --status-error: #fecaca;
      --link: #93c5fd;
      --link-hover: #bfdbfe;
      --tab-bg: rgba(15, 23, 42, 0.9);
      --tab-active-bg: rgba(30, 64, 175, 0.9);
      --tab-border: rgba(148, 163, 184, 0.45);
    }

    body.light {
      --bg: radial-gradient(circle at top, #eff6ff, #e5e7eb);
      --text: #111827;
      --muted: #6b7280;
      --muted-strong: #4b5563;
      --card-bg: #f9fafb;
      --border-color: rgba(148, 163, 184, 0.6);
      --pill-bg: #e5e7eb;
      --pill-border: rgba(148, 163, 184, 0.9);
      --input-bg: #f3f4f6;
      --shadow-heavy: 0 14px 30px rgba(148, 163, 184, 0.45);
      --shadow-card: 0 10px 24px rgba(148, 163, 184, 0.35);
      --divider: rgba(209, 213, 219, 0.9);
      --badge-blue-bg: rgba(37, 99, 235, 0.08);
      --badge-blue-border: rgba(37, 99, 235, 0.45);
      --badge-blue-text: #1d4ed8;
      --status-ok: #15803d;
      --status-error: #b91c1c;
      --link: #1d4ed8;
      --link-hover: #1d4ed8;
      --tab-bg: #e5e7eb;
      --tab-active-bg: #1d4ed8;
      --tab-border: rgba(148, 163, 184, 0.9);
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 16px;
      transition: background 0.35s ease, color 0.15s ease;
    }

    .app-shell {
      width: 100%;
      max-width: 1100px;
    }

    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 10px;
      flex-wrap: wrap;
    }

    h1 {
      margin: 0;
      font-size: 1.9rem;
      text-align: left;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .tagline {
      margin: 4px 0 0;
      color: var(--muted-strong);
      font-size: 0.9rem;
    }

    .brand {
      display: flex;
      flex-direction: column;
    }

    .theme-toggle {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid var(--border-color);
      background: rgba(15, 23, 42, 0.3);
      box-shadow: var(--shadow-card);
      font-size: 0.8rem;
      cursor: pointer;
      white-space: nowrap;
    }

    body.light .theme-toggle {
      background: rgba(255, 255, 255, 0.8);
    }

    .theme-toggle span.mode-label {
      font-weight: 500;
    }

    .theme-toggle-inner {
      width: 38px;
      height: 20px;
      border-radius: 999px;
      background: #0f172a;
      position: relative;
      border: 1px solid rgba(148, 163, 184, 0.8);
      transition: background 0.25s ease, border-color 0.25s ease;
    }

    body.light .theme-toggle-inner {
      background: #e5e7eb;
      border-color: rgba(148, 163, 184, 1);
    }

    .theme-knob {
      position: absolute;
      top: 1px;
      left: 1px;
      width: 16px;
      height: 16px;
      border-radius: 999px;
      background: #facc15;
      box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.2);
      transform: translateX(0);
      transition: transform 0.25s ease;
    }

    body.light .theme-knob {
      transform: translateX(18px);
      background: #0f172a;
    }

    .tabs {
      display: inline-flex;
      border-radius: 999px;
      overflow: hidden;
      border: 1px solid var(--tab-border);
      background: var(--tab-bg);
      box-shadow: var(--shadow-card);
      margin: 0 auto 12px;
    }

    .tab-btn {
      padding: 8px 16px;
      border: none;
      background: transparent;
      color: var(--muted-strong);
      cursor: pointer;
      font-size: 0.85rem;
      font-weight: 500;
      transition: background 0.15s ease, color 0.15s ease;
      white-space: nowrap;
    }

    .tab-btn.active {
      background: var(--tab-active-bg);
      color: white;
    }

    .tab-btn + .tab-btn {
      border-left: 1px solid rgba(148, 163, 184, 0.3);
    }

    .mode {
      margin-top: 12px;
    }

    .hidden {
      display: none;
    }

    .search-card {
      background: var(--card-bg);
      border-radius: 16px;
      padding: 14px 16px;
      box-shadow: var(--shadow-heavy);
      border: 1px solid var(--border-color);
      margin-bottom: 12px;
    }

    .search-row {
      display: flex;
      gap: 10px;
      margin-bottom: 4px;
      flex-wrap: wrap;
    }

    .search-row input {
      flex: 1;
      padding: 10px 12px;
      border-radius: 999px;
      border: 1px solid var(--border-color);
      background: var(--input-bg);
      color: var(--text);
      outline: none;
      font-size: 0.95rem;
    }

    .search-row input::placeholder {
      color: var(--muted);
    }

    .search-row button {
      padding: 10px 18px;
      border-radius: 999px;
      border: none;
      background: linear-gradient(135deg, #22c55e, #16a34a);
      color: white;
      font-weight: 600;
      font-size: 0.9rem;
      cursor: pointer;
      transition: transform 0.09s ease, box-shadow 0.1s ease, opacity 0.14s ease;
      white-space: nowrap;
      box-shadow: 0 10px 22px rgba(22, 163, 74, 0.4);
    }

    .search-row button:active {
      transform: translateY(1px) scale(0.98);
      box-shadow: 0 5px 12px rgba(22, 163, 74, 0.45);
    }

    .hint {
      font-size: 0.8rem;
      color: var(--muted-strong);
      margin-top: 2px;
    }

    .status {
      margin-top: 8px;
      font-size: 0.8rem;
      min-height: 1em;
    }

    .status.error {
      color: var(--status-error);
    }

    .status.ok {
      color: var(--status-ok);
    }

    .grid {
      width: 100%;
      display: grid;
      gap: 16px;
      margin-top: 8px;
    }

    @media (min-width: 900px) {
      .grid-two {
        grid-template-columns: 3fr 2fr;
        align-items: flex-start;
      }
      .grid-compare {
        grid-template-columns: 1fr 1fr;
      }
    }

    .card {
      background: var(--card-bg);
      border-radius: 16px;
      padding: 16px 18px;
      border: 1px solid var(--border-color);
      box-shadow: var(--shadow-card);
    }

    .card h2, .card h3 {
      margin-top: 0;
      margin-bottom: 8px;
      font-size: 1.1rem;
    }

    .flag-row {
      display: flex;
      align-items: center;
      gap: 14px;
      margin-bottom: 10px;
      flex-wrap: wrap;
    }

    .flag-row img {
      width: 80px;
      height: 50px;
      object-fit: cover;
      border-radius: 8px;
      border: 1px solid var(--border-color);
    }

    .pill {
      display: inline-flex;
      align-items: center;
      padding: 4px 10px;
      border-radius: 999px;
      background: var(--pill-bg);
      font-size: 0.75rem;
      color: var(--text);
      border: 1px solid var(--pill-border);
      margin-right: 4px;
      margin-bottom: 4px;
    }

    .meta-item {
      font-size: 0.9rem;
      margin-bottom: 4px;
    }

    .meta-label {
      font-weight: 600;
      color: var(--muted-strong);
    }

    .section-title {
      font-size: 0.85rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: var(--muted-strong);
      margin-bottom: 6px;
    }

    .paragraph {
      font-size: 0.9rem;
      line-height: 1.5;
      color: var(--text);
      margin-bottom: 8px;
    }

    .small {
      font-size: 0.8rem;
      color: var(--muted-strong);
      margin-top: 8px;
    }

    .divider {
      margin: 10px 0;
      border-top: 1px dashed var(--divider);
    }

    .badge {
      display: inline-flex;
      align-items: center;
      padding: 4px 8px;
      border-radius: 999px;
      background: var(--badge-blue-bg);
      font-size: 0.75rem;
      color: var(--badge-blue-text);
      border: 1px solid var(--badge-blue-border);
      margin-right: 4px;
      margin-bottom: 4px;
    }

    .muted {
      color: var(--muted);
    }

    a {
      color: var(--link);
      text-decoration: none;
    }

    a:hover {
      text-decoration: underline;
      color: var(--link-hover);
    }

    .actions-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      margin-top: 10px;
      flex-wrap: wrap;
    }

    .fav-btn {
      border-radius: 999px;
      padding: 6px 10px;
      border: 1px solid var(--border-color);
      background: rgba(15, 23, 42, 0.75);
      color: var(--text);
      font-size: 0.8rem;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
    }

    .fav-btn span.star {
      font-size: 1rem;
    }

    body.light .fav-btn {
      background: rgba(249, 250, 251, 0.95);
    }

    .fav-btn.saved span.star {
      color: #facc15;
    }

    .favorites-list {
      list-style: none;
      margin: 0;
      padding: 0;
      margin-top: 6px;
    }

    .favorites-list li {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 6px 0;
      border-bottom: 1px dashed var(--divider);
      font-size: 0.9rem;
    }

    .favorites-list button {
      padding: 4px 8px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-size: 0.78rem;
      background: linear-gradient(135deg, #3b82f6, #2563eb);
      color: white;
    }

    .favorites-empty {
      font-size: 0.9rem;
      color: var(--muted);
      margin-top: 6px;
    }

    .fav-header-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }

    .small-btn {
      padding: 5px 9px;
      border-radius: 999px;
      border: 1px solid var(--border-color);
      background: transparent;
      color: var(--muted-strong);
      font-size: 0.78rem;
      cursor: pointer;
    }

    .small-btn.danger {
      border-color: rgba(239, 68, 68, 0.8);
      color: #fecaca;
    }

    body.light .small-btn.danger {
      color: #b91c1c;
    }

    .compare-label {
      font-size: 0.8rem;
      color: var(--muted-strong);
    }

    .compare-inputs {
      display: flex;
      gap: 8px;
      margin-bottom: 6px;
      flex-wrap: wrap;
    }

    .compare-inputs input {
      flex: 1;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid var(--border-color);
      background: var(--input-bg);
      color: var(--text);
      outline: none;
      font-size: 0.9rem;
    }

    .compare-inputs input::placeholder {
      color: var(--muted);
    }

    .compare-status {
      font-size: 0.8rem;
      margin-top: 6px;
      min-height: 1em;
    }

    .compare-status.error {
      color: var(--status-error);
    }

    .compare-status.ok {
      color: var(--status-ok);
    }

    .compare-note {
      margin-top: 6px;
      font-size: 0.78rem;
      color: var(--muted);
    }

    @media (max-width: 640px) {
      header {
        align-items: flex-start;
      }
      h1 {
        font-size: 1.6rem;
      }
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <header>
      <div class="brand">
        <h1>üåç Ultimate Country Explorer</h1>
        <p class="tagline">REST Countries + Wikipedia. No API keys. Just data.</p>
      </div>
      <button id="themeToggle" class="theme-toggle" type="button">
        <span class="mode-label">Dark</span>
        <div class="theme-toggle-inner">
          <div class="theme-knob"></div>
        </div>
      </button>
    </header>

    <div class="tabs">
      <button class="tab-btn active" data-mode="explorer" type="button">Explorer</button>
      <button class="tab-btn" data-mode="compare" type="button">Compare</button>
      <button class="tab-btn" data-mode="favorites" type="button">Favorites</button>
    </div>

    <!-- Explorer mode -->
    <section id="modeExplorer" class="mode">
      <div class="search-card">
        <div class="search-row">
          <input
            id="countryInput"
            type="text"
            placeholder="Search a country‚Ä¶ e.g. India, Japan, Brazil"
            autocomplete="off"
          />
          <button id="searchBtn" type="button">Search</button>
        </div>
        <div class="hint">
          Press <strong>Enter</strong> to search ‚Ä¢ Requires internet to fetch data
        </div>
        <div id="status" class="status"></div>
      </div>

      <div id="resultsGrid" class="grid grid-two hidden">
        <div class="card" id="basicCard"></div>
        <div class="card" id="extraCard"></div>
      </div>

      <div class="actions-row">
        <button id="favBtn" class="fav-btn" type="button" disabled>
          <span class="star">‚òÜ</span>
          <span class="label">Save to favorites</span>
        </button>
        <span class="small">
          Favorites and theme are stored locally in your browser only.
        </span>
      </div>
    </section>

    <!-- Compare mode -->
    <section id="modeCompare" class="mode hidden">
      <div class="search-card">
        <div class="compare-label">Compare two countries side by side.</div>
        <div class="compare-inputs">
          <input id="compareInputA" type="text" placeholder="Country A‚Ä¶ e.g. India" />
          <input id="compareInputB" type="text" placeholder="Country B‚Ä¶ e.g. China" />
        </div>
        <div class="search-row" style="margin-top:4px;">
          <button id="compareBtn" type="button">Compare</button>
        </div>
        <div id="compareStatus" class="compare-status"></div>
        <div class="compare-note">
          Uses REST Countries + Wikipedia summaries for both countries.
        </div>
      </div>

      <div id="compareGrid" class="grid grid-compare hidden">
        <div class="card" id="compareCardA"></div>
        <div class="card" id="compareCardB"></div>
      </div>
    </section>

    <!-- Favorites mode -->
    <section id="modeFavorites" class="mode hidden">
      <div class="card">
        <div class="fav-header-row">
          <div>
            <div class="section-title">Favorites</div>
            <p class="paragraph" style="margin-bottom:4px;">
              Saved countries from Explorer. Click ‚ÄúOpen‚Äù to load them back into Explorer instantly.
            </p>
          </div>
          <button id="clearFavsBtn" type="button" class="small-btn danger">Clear all</button>
        </div>
        <ul id="favoritesList" class="favorites-list"></ul>
        <div id="favoritesEmpty" class="favorites-empty hidden">
          No favorites yet. Go to <strong>Explorer</strong>, search a country, and hit ‚ÄúSave to favorites‚Äù.
        </div>
        <p class="small">
          Favorites are stored only in this browser via <code>localStorage</code>. They won‚Äôt sync across devices.
        </p>
      </div>
    </section>
  </div>

  <script>
    const THEME_KEY = "ucx-theme";
    const FAV_KEY = "ucx-favorites";

    const themeToggleBtn = document.getElementById("themeToggle");
    const tabButtons = Array.from(document.querySelectorAll(".tab-btn"));
    const modeExplorer = document.getElementById("modeExplorer");
    const modeCompare = document.getElementById("modeCompare");
    const modeFavorites = document.getElementById("modeFavorites");

    const inputEl = document.getElementById("countryInput");
    const searchBtn = document.getElementById("searchBtn");
    const statusEl = document.getElementById("status");
    const gridEl = document.getElementById("resultsGrid");
    const basicCardEl = document.getElementById("basicCard");
    const extraCardEl = document.getElementById("extraCard");
    const favBtn = document.getElementById("favBtn");

    const compareInputA = document.getElementById("compareInputA");
    const compareInputB = document.getElementById("compareInputB");
    const compareBtn = document.getElementById("compareBtn");
    const compareStatusEl = document.getElementById("compareStatus");
    const compareGridEl = document.getElementById("compareGrid");
    const compareCardA = document.getElementById("compareCardA");
    const compareCardB = document.getElementById("compareCardB");

    const favoritesListEl = document.getElementById("favoritesList");
    const favoritesEmptyEl = document.getElementById("favoritesEmpty");
    const clearFavsBtn = document.getElementById("clearFavsBtn");

    let currentMode = "explorer";
    let currentCountryName = null;
    let favorites = [];

    function setStatus(message, isError = false) {
      statusEl.textContent = message || "";
      statusEl.classList.toggle("error", !!isError);
      statusEl.classList.toggle("ok", !isError && !!message);
    }

    function setCompareStatus(message, isError = false) {
      compareStatusEl.textContent = message || "";
      compareStatusEl.classList.toggle("error", !!isError);
      compareStatusEl.classList.toggle("ok", !isError && !!message);
    }

    function showGrid(show) {
      if (show) gridEl.classList.remove("hidden");
      else gridEl.classList.add("hidden");
    }

    function showCompareGrid(show) {
      if (show) compareGridEl.classList.remove("hidden");
      else compareGridEl.classList.add("hidden");
    }

    function safeJoin(arr, fallback = "N/A") {
      if (!Array.isArray(arr) || arr.length === 0) return fallback;
      return arr.join(", ");
    }

    function formatNumber(num) {
      if (typeof num !== "number") return "N/A";
      return num.toLocaleString();
    }

    function loadTheme() {
      try {
        const stored = localStorage.getItem(THEME_KEY);
        if (stored === "light") {
          document.body.classList.add("light");
          const label = themeToggleBtn.querySelector(".mode-label");
          if (label) label.textContent = "Light";
        }
      } catch (e) {}
    }

    function toggleTheme() {
      const isLight = document.body.classList.toggle("light");
      const label = themeToggleBtn.querySelector(".mode-label");
      if (label) label.textContent = isLight ? "Light" : "Dark";
      try {
        localStorage.setItem(THEME_KEY, isLight ? "light" : "dark");
      } catch (e) {}
    }

    function switchMode(mode) {
      currentMode = mode;
      modeExplorer.classList.add("hidden");
      modeCompare.classList.add("hidden");
      modeFavorites.classList.add("hidden");

      if (mode === "explorer") modeExplorer.classList.remove("hidden");
      else if (mode === "compare") modeCompare.classList.remove("hidden");
      else if (mode === "favorites") modeFavorites.classList.remove("hidden");

      tabButtons.forEach((btn) => {
        btn.classList.toggle("active", btn.dataset.mode === mode);
      });
    }

    async function fetchCountryBaseInfo(name) {
      const encoded = encodeURIComponent(name.trim());
      const urls = [
        "https://restcountries.com/v3.1/name/" + encoded + "?fullText=true",
        "https://restcountries.com/v3.1/name/" + encoded
      ];

      for (const url of urls) {
        const resp = await fetch(url);
        if (resp.ok) {
          const data = await resp.json();
          if (Array.isArray(data) && data.length > 0) {
            return data[0];
          }
        }
      }

      throw new Error("Country not found in RESTCountries API.");
    }

    async function fetchWikipediaSummary(possibleNames) {
      const tried = [];
      for (const rawName of possibleNames) {
        if (!rawName) continue;
        const title = encodeURIComponent(rawName);
        const url = "https://en.wikipedia.org/api/rest_v1/page/summary/" + title;
        tried.push(rawName);
        try {
          const resp = await fetch(url);
          if (!resp.ok) continue;
          const data = await resp.json();
          if (data && data.extract) {
            return {
              extract: data.extract,
              url:
                (data.content_urls &&
                  (data.content_urls.desktop?.page ||
                    data.content_urls.mobile?.page)) || null,
              title: data.title || rawName
            };
          }
        } catch (e) {}
      }

      return {
        extract: "No Wikipedia summary could be loaded for this country.",
        url: null,
        title: tried[0] || ""
      };
    }

    function renderBasicCard(country, wikiInfo) {
      const nameCommon = (country.name && country.name.common) || "Unknown";
      const nameOfficial = (country.name && country.name.official) || null;
      const flags = country.flags || {};
      const flagPng = flags.png || flags.svg || "";
      const capital = Array.isArray(country.capital)
        ? country.capital[0]
        : (country.capital || "N/A");
      const population = formatNumber(country.population);
      const region = country.region || "N/A";
      const subregion = country.subregion || null;
      const languages = country.languages ? Object.values(country.languages) : [];
      const currenciesObj = country.currencies || null;
      const currencies = currenciesObj
        ? Object.values(currenciesObj)
            .map((c) => c.name || "")
            .filter(Boolean)
        : [];
      const tld = Array.isArray(country.tld) ? country.tld[0] : null;
      const cca2 = country.cca2 || null;
      const cca3 = country.cca3 || null;
      const area = typeof country.area === "number" ? country.area.toLocaleString() + " km¬≤" : "N/A";
      const timezones = Array.isArray(country.timezones) ? country.timezones : [];

      basicCardEl.innerHTML = `
        <div class="section-title">Core Facts</div>
        <div class="flag-row">
          ${flagPng ? '<img src="' + flagPng + '" alt="Flag of ' + nameCommon + '" />' : ""}
          <div>
            <h3>${nameCommon}</h3>
            ${
              nameOfficial && nameOfficial !== nameCommon
                ? '<div class="muted" style="font-size:0.8rem;">Official: ' +
                  nameOfficial +
                  "</div>"
                : ""
            }
            <div style="margin-top:6px;">
              ${region ? '<span class="pill">' + region + "</span>" : ""}
              ${subregion ? '<span class="pill">' + subregion + "</span>" : ""}
            </div>
          </div>
        </div>

        <div class="divider"></div>

        <div class="meta-item">
          <span class="meta-label">Capital:</span> ${capital}
        </div>
        <div class="meta-item">
          <span class="meta-label">Population:</span> ${population}
        </div>
        <div class="meta-item">
          <span class="meta-label">Area:</span> ${area}
        </div>
        <div class="meta-item">
          <span class="meta-label">Languages:</span> ${safeJoin(languages, "N/A")}
        </div>
        <div class="meta-item">
          <span class="meta-label">Currencies:</span> ${safeJoin(currencies, "N/A")}
        </div>
        <div class="meta-item">
          <span class="meta-label">Country Codes:</span>
          ${cca2 || ""} ${cca3 ? " / " + cca3 : ""}
        </div>
        ${
          tld
            ? '<div class="meta-item"><span class="meta-label">Top-level domain:</span> ' +
              tld +
              "</div>"
            : ""
        }
        ${
          timezones.length
            ? '<div class="meta-item"><span class="meta-label">Timezones:</span> ' +
              safeJoin(timezones) +
              "</div>"
            : ""
        }
      `;
    }

    function renderExtraCard(country, wikiInfo) {
      const nameCommon = (country.name && country.name.common) || "Unknown";
      const borders = Array.isArray(country.borders) ? country.borders : [];
      const wikilink =
        wikiInfo && wikiInfo.url
          ? '<a href="' +
            wikiInfo.url +
            '" target="_blank" rel="noopener noreferrer">Open full article ‚Üó</a>'
          : "";

      extraCardEl.innerHTML = `
        <div class="section-title">History & Wikipedia</div>
        <div class="paragraph">
          ${(wikiInfo && wikiInfo.extract) || "No historical / overview text found."}
        </div>
        ${
          wikilink
            ? '<div class="small">' + wikilink + "</div>"
            : '<div class="small muted">No direct Wikipedia page link available.</div>'
        }

        <div class="divider"></div>
        <div class="section-title">Extra Info</div>
        <p class="paragraph">
          ${nameCommon} data is fetched from public sources:
          <span class="badge">REST Countries API</span>
          <span class="badge">Wikipedia API</span>
        </p>
        ${
          borders.length
            ? '<div class="meta-item"><span class="meta-label">Bordering countries (codes):</span> ' +
              safeJoin(borders) +
              "</div>"
            : '<div class="meta-item"><span class="meta-label">Bordering countries:</span> N/A or island nation</div>'
        }
        <p class="small">
          For detailed politics, ruling parties, and leaders, check the full Wikipedia page.
        </p>
      `;
    }

    function renderCompareCard(containerEl, country, wikiInfo) {
      const nameCommon = (country.name && country.name.common) || "Unknown";
      const flags = country.flags || {};
      const flagPng = flags.png || flags.svg || "";
      const capital = Array.isArray(country.capital)
        ? country.capital[0]
        : (country.capital || "N/A");
      const population = formatNumber(country.population);
      const region = country.region || "N/A";
      const area = typeof country.area === "number" ? country.area.toLocaleString() + " km¬≤" : "N/A";
      const wikiSnippet =
        wikiInfo && wikiInfo.extract
          ? wikiInfo.extract.slice(0, 200) + (wikiInfo.extract.length > 200 ? "‚Ä¶" : "")
          : "No summary available.";

      containerEl.innerHTML = `
        <div class="flag-row">
          ${flagPng ? '<img src="' + flagPng + '" alt="Flag of ' + nameCommon + '" />' : ""}
          <div>
            <h3>${nameCommon}</h3>
            <div style="margin-top:4px;">
              ${region ? '<span class="pill">' + region + "</span>" : ""}
            </div>
          </div>
        </div>

        <div class="divider"></div>

        <div class="meta-item">
          <span class="meta-label">Capital:</span> ${capital}
        </div>
        <div class="meta-item">
          <span class="meta-label">Population:</span> ${population}
        </div>
        <div class="meta-item">
          <span class="meta-label">Area:</span> ${area}
        </div>

        <div class="divider"></div>
        <div class="section-title">Wikipedia snippet</div>
        <div class="paragraph">${wikiSnippet}</div>
      `;
    }

    function loadFavorites() {
      try {
        const raw = localStorage.getItem(FAV_KEY);
        if (!raw) {
          favorites = [];
        } else {
          const parsed = JSON.parse(raw);
          favorites = Array.isArray(parsed) ? parsed : [];
        }
      } catch (e) {
        favorites = [];
      }
      renderFavoritesList();
      updateFavButtonState();
    }

    function saveFavorites() {
      try {
        localStorage.setItem(FAV_KEY, JSON.stringify(favorites));
      } catch (e) {}
    }

    function addFavorite(name) {
      if (!name) return;
      const exists = favorites.some(
        (f) => f.name.toLowerCase() === name.toLowerCase()
      );
      if (exists) return;
      favorites.push({ name, addedAt: Date.now() });
      saveFavorites();
      renderFavoritesList();
      updateFavButtonState();
    }

    function clearFavorites() {
      favorites = [];
      saveFavorites();
      renderFavoritesList();
      updateFavButtonState();
    }

    function renderFavoritesList() {
      favoritesListEl.innerHTML = "";
      if (!favorites.length) {
        favoritesEmptyEl.classList.remove("hidden");
        return;
      }
      favoritesEmptyEl.classList.add("hidden");
      favorites
        .slice()
        .sort((a, b) => (a.name.toLowerCase() > b.name.toLowerCase() ? 1 : -1))
        .forEach((fav) => {
          const li = document.createElement("li");
          li.innerHTML = `
            <span>${fav.name}</span>
            <button type="button" data-country="${fav.name}">Open</button>
          `;
          favoritesListEl.appendChild(li);
        });
    }

    function updateFavButtonState() {
      if (!currentCountryName) {
        favBtn.disabled = true;
        favBtn.classList.remove("saved");
        favBtn.querySelector(".star").textContent = "‚òÜ";
        favBtn.querySelector(".label").textContent = "Save to favorites";
        return;
      }
      favBtn.disabled = false;
      const isFav = favorites.some(
        (f) => f.name.toLowerCase() === currentCountryName.toLowerCase()
      );
      favBtn.classList.toggle("saved", isFav);
      favBtn.querySelector(".star").textContent = isFav ? "‚òÖ" : "‚òÜ";
      favBtn.querySelector(".label").textContent = isFav
        ? "Saved to favorites"
        : "Save to favorites";
    }

    async function handleSearch() {
      const raw = inputEl.value || "";
      const name = raw.trim();

      if (!name) {
        setStatus("Please type a country name first.", true);
        showGrid(false);
        currentCountryName = null;
        updateFavButtonState();
        return;
      }

      setStatus("Loading data from REST Countries + Wikipedia‚Ä¶", false);
      showGrid(false);
      currentCountryName = null;
      updateFavButtonState();

      try {
        const country = await fetchCountryBaseInfo(name);

        const possibleNames = [];
        if (country.name && country.name.common) possibleNames.push(country.name.common);
        if (country.name && country.name.official) possibleNames.push(country.name.official);
        const wikiInfo = await fetchWikipediaSummary(possibleNames);

        renderBasicCard(country, wikiInfo);
        renderExtraCard(country, wikiInfo);
        showGrid(true);

        const displayName = (country.name && country.name.common) || name;
        currentCountryName = displayName;
        updateFavButtonState();

        setStatus("Data loaded successfully.", false);
      } catch (err) {
        console.error(err);
        setStatus(
          err.message || "Something went wrong. Try a different country name.",
          true
        );
        showGrid(false);
        currentCountryName = null;
        updateFavButtonState();
      }
    }

    async function handleCompare() {
      const a = (compareInputA.value || "").trim();
      const b = (compareInputB.value || "").trim();

      if (!a || !b) {
        setCompareStatus("Please enter both Country A and Country B.", true);
        showCompareGrid(false);
        return;
      }

      if (a.toLowerCase() === b.toLowerCase()) {
        setCompareStatus("Enter two different countries to compare.", true);
        showCompareGrid(false);
        return;
      }

      setCompareStatus("Loading comparison data‚Ä¶", false);
      showCompareGrid(false);

      try {
        const [countryA, countryB] = await Promise.all([
          fetchCountryBaseInfo(a),
          fetchCountryBaseInfo(b)
        ]);

        const namesA = [];
        if (countryA.name && countryA.name.common) namesA.push(countryA.name.common);
        if (countryA.name && countryA.name.official) namesA.push(countryA.name.official);

        const namesB = [];
        if (countryB.name && countryB.name.common) namesB.push(countryB.name.common);
        if (countryB.name && countryB.name.official) namesB.push(countryB.name.official);

        const [wikiA, wikiB] = await Promise.all([
          fetchWikipediaSummary(namesA),
          fetchWikipediaSummary(namesB)
        ]);

        renderCompareCard(compareCardA, countryA, wikiA);
        renderCompareCard(compareCardB, countryB, wikiB);

        showCompareGrid(true);
        setCompareStatus("Comparison loaded.", false);
      } catch (err) {
        console.error(err);
        setCompareStatus(
          err.message ||
            "Could not load one or both countries. Try checking the spellings.",
          true
        );
        showCompareGrid(false);
      }
    }

    themeToggleBtn.addEventListener("click", toggleTheme);

    tabButtons.forEach((btn) => {
      btn.addEventListener("click", () => {
        const mode = btn.dataset.mode || "explorer";
        switchMode(mode);
      });
    });

    searchBtn.addEventListener("click", handleSearch);

    inputEl.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        handleSearch();
      }
    });

    compareBtn.addEventListener("click", handleCompare);

    compareInputA.addEventListener("keydown", (e) => {
      if (e.key === "Enter") handleCompare();
    });

    compareInputB.addEventListener("keydown", (e) => {
      if (e.key === "Enter") handleCompare();
    });

    favBtn.addEventListener("click", () => {
      if (!currentCountryName) return;
      const isFav = favorites.some(
        (f) => f.name.toLowerCase() === currentCountryName.toLowerCase()
      );
      if (!isFav) {
        addFavorite(currentCountryName);
      }
    });

    favoritesListEl.addEventListener("click", (e) => {
      const btn = e.target.closest("button[data-country]");
      if (!btn) return;
      const countryName = btn.getAttribute("data-country");
      if (!countryName) return;
      switchMode("explorer");
      inputEl.value = countryName;
      handleSearch();
    });

    clearFavsBtn.addEventListener("click", () => {
      if (!favorites.length) return;
      const ok = confirm("Clear all favorite countries?");
      if (!ok) return;
      clearFavorites();
    });

    loadTheme();
    loadFavorites();
  </script>
</body>
</html>
